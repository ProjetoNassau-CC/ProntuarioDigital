package modeloDAO;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import conexao.Conexao;
import prontuario.Anamnese;
import prontuario.Dentista;
import prontuario.Endereco;
import prontuario.Paciente;
import prontuario.Recepcionista;

public class CrudPaciente {
	
	
	public void inserirPaciente(Paciente pac) {
		Conexao conex = new Conexao();
		
		conex.conexao();
		try {
			String sql = "INSERT INTO paciente(nome,email,celular,datanasc,cpf,rg,rua,bairro,cep,cidade,uf,numero,complemento) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)";
			PreparedStatement stmt = conex.con.prepareStatement(sql);
				stmt.setString(1, pac.getNome());
				stmt.setString(2, pac.getEmail());
				stmt.setString(3, pac.getCel());
				stmt.setString(4, pac.getData_nascimento());
				stmt.setString(5, pac.getCpf());
				stmt.setString(6, pac.getRg());
				stmt.setString(7, pac.getEndereco().getRua());
				stmt.setString(8,	pac.getEndereco().getBairro());
				stmt.setString(9, pac.getEndereco().getCep());
				stmt.setString(10, pac.getEndereco().getCidade());
				stmt.setString(11, pac.getEndereco().getUf());
				stmt.setString(12, pac.getEndereco().getNumero());
				stmt.setString(13, pac.getEndereco().getComplemento());
				stmt.execute();
				System.out.println("cadastrado com sucesso");
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	
	
	
	public Paciente consultaPaciente(Paciente paciente) {
		try {
		Conexao conex = new Conexao();
		conex.conexao();
	
		Endereco endPaciente = new Endereco();
		String sql = "select * from paciente where cpf = ? ";
		PreparedStatement stmt = conex.con.prepareStatement(sql);
		stmt.setString(1,paciente.getCpf());
		
		ResultSet rs = stmt.executeQuery();
		//verifica se a consulta encontrou um funcionario com o CPF informado.
		if(rs.next()) { 
			paciente.setCodigo(rs.getInt("codigo"));
			paciente.setNome(rs.getString("nome"));
			paciente.setEmail(rs.getString("email"));
			paciente.setCel(rs.getString("celular"));
			paciente.setData_nascimento(rs.getString("datanasc"));
			paciente.setCpf(rs.getString("cpf"));
			paciente.setRg(rs.getString("rg"));
			endPaciente.setRua(rs.getString("rua"));
			endPaciente.setBairro(rs.getString("bairro"));
			endPaciente.setCep(rs.getString("cep"));
			endPaciente.setCidade(rs.getString("cidade"));
			endPaciente.setUf(rs.getString("uf"));
			endPaciente.setNumero(rs.getString("numero"));
			endPaciente.setComplemento(rs.getString("complemento"));
			paciente.setEndereco(endPaciente);
		
			return paciente;
		}else {
			System.out.println("dados informados não pertence a um paciente cadastrado");
			
		}
		
		
	}catch (Exception e) {
	}
		return null;
	}
	
	
	public void removerPaciente(Paciente paciente) {
		Conexao conex = new Conexao();
		conex.conexao();
		String sql = "delete from paciente where  cpf = ? ";
		String consultaFuncao = "select * from paciente where cpf = ?";
		PreparedStatement stm;
		try {
			stm = conex.con.prepareStatement(consultaFuncao);
			stm.setString(1,paciente.getCpf());
		
			ResultSet rs = stm.executeQuery();
			if(rs.next()) { 
				paciente.setCpf(rs.getString("cpf"));
				PreparedStatement stmt = conex.con.prepareStatement(sql);
				stmt.setString(1,paciente.getCpf());
				stmt.executeUpdate();
				System.out.println("excluido com sucesso");
			} else {
				System.out.println(" Não é permitido excluir pois esse cpf nnão encontra-se cadastrado no sistema!");
			}
		} catch (SQLException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		
	}
	

}
